<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Advanced Elasticsearch GUI</title>

  <!-- Bootstrap 5 CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/main.css" />
  <link rel="stylesheet" href="css/dark-mode.css" />

</head>
<body>

  <!-- ===== Navigation & Header ===== -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light" id="topNavbar">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Elasticsearch GUI</a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent"
        aria-expanded="false"
        aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div
        class="collapse navbar-collapse"
        id="navbarSupportedContent"
      >
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <!-- Dark Mode Toggle Switch -->
            <div class="dark-mode-toggle form-check form-switch mt-2" aria-label="Toggle Dark Mode">
              <input
                class="form-check-input"
                type="checkbox"
                id="darkModeToggle"
                aria-label="Toggle Dark Mode"
              />
              <label class="form-check-label" for="darkModeToggle">Dark</label>
            </div>
          </li>
          <li class="nav-item">
            <!-- Contrast Level Slider -->
            <div class="contrast-selector d-flex align-items-center mt-2 ms-3">
              <label for="contrastLevel" class="me-2 mb-0">Contrast:</label>
              <input
                type="range"
                id="contrastLevel"
                class="form-range contrast-slider"
                min="0.5"
                max="2"
                step="0.1"
                value="1"
                aria-label="Adjust Contrast Level"
              />
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- ===== Main Container ===== -->
  <div class="container-fluid my-3">

    <!-- Connection Form -->
    <section class="row g-3 form-section" id="connectionSection">
      <h3>Connection</h3>
      <form id="connectionForm" class="row gx-3 gy-2 align-items-end" aria-label="Elasticsearch Connection Form">
        <div class="col-md-4">
          <label for="esUrl" class="form-label">Elasticsearch URL</label>
          <input
            type="url"
            class="form-control"
            id="esUrl"
            placeholder="http://localhost:9200"
            required
            aria-required="true"
            pattern="https?://.+"
            title="Please enter a valid URL starting with http:// or https://"
          />
        </div>
        <div class="col-md-3">
          <label for="username" class="form-label">Username</label>
          <input
            type="text"
            class="form-control"
            id="username"
            placeholder="elastic"
            aria-label="Elasticsearch Username"
          />
        </div>
        <div class="col-md-3">
          <label for="password" class="form-label">Password</label>
          <input
            type="password"
            class="form-control"
            id="password"
            placeholder="Your Password"
            aria-label="Elasticsearch Password"
          />
        </div>
        <div class="col-md-2 d-flex">
          <button
            type="submit"
            class="btn btn-primary w-100"
            aria-label="Connect to Elasticsearch"
          >
            Connect
          </button>
        </div>
      </form>
      <div class="col-12 mt-3" id="clusterInfo" aria-live="polite"></div>
    </section>

    <!-- Index Management & Mapping Display -->
    <section class="row g-3 form-section" id="indexManagementSection">
      <h3>Index Management</h3>
      <div class="col-md-4">
        <label for="indexSelect" class="form-label">Select Index:</label>
        <select id="indexSelect" class="form-select" aria-label="Select Elasticsearch Index">
          <option value="">-- Connect to load indices --</option>
        </select>
      </div>
      <div class="col-md-8" id="mappingStatus" aria-live="polite"></div>

      <div class="col-12 table-container">
        <table class="table table-bordered table-striped" id="mappingTable" aria-label="Index Mapping Table">
          <thead>
            <tr>
              <th scope="col">Field Name</th>
              <th scope="col">Field Type</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Data Grid + Export + Column Selection -->
    <section class="row g-3 form-section" id="dataGridSection">
      <!-- Section Title -->
      <div class="col-12">
        <h3>Data Grid</h3>
      </div>
    
      <!-- Export Buttons + Reset Filters -->
      <div class="col-12 mb-2">
        <div class="export-btn-group d-flex flex-wrap justify-content-end gap-2">
          <button
            class="btn btn-secondary btn-export"
            id="exportCsvBtn"
            aria-label="Export as CSV"
          >
            Export CSV
          </button>
          <button
            class="btn btn-secondary btn-export"
            id="exportJsonBtn"
            aria-label="Export as JSON"
          >
            Export JSON
          </button>
          <button
            class="btn btn-secondary btn-export"
            id="exportExcelBtn"
            aria-label="Export as Excel"
          >
            Export Excel
          </button>
          <button
            class="btn btn-info btn-export"
            id="selectColumnsBtn"
            aria-label="Select Columns to Display"
          >
            Select Columns
          </button>
          <button
            class="btn btn-danger btn-export"
            id="exportPdfBtn"
            aria-label="Export as PDF"
          >
            Export PDF
          </button>
          <!-- Moved Reset Filters button alongside the export buttons -->
          <button
            id="resetFiltersBtn"
            class="btn btn-warning"
            aria-label="Reset all filters"
          >
            Reset Filters
          </button>
        </div>
      </div>
    
      <!-- Results Table + Pagination -->
      <div class="col-12">
        <div class="table-container">
          <table
            class="table table-bordered table-striped"
            id="resultsTable"
            aria-label="Search Results Table"
          >
            <thead id="resultsHeader"></thead>
            <tbody id="resultsBody"></tbody>
          </table>
        </div>
    
        <!-- Pagination Controls -->
        <div class="pagination-controls">
          <div class="pagination-buttons">
            <button
              id="prevPageBtn"
              class="btn btn-outline-primary"
              aria-label="Previous Page"
            >
              Previous
            </button>
            <button
              id="nextPageBtn"
              class="btn btn-primary"
              aria-label="Next Page"
            >
              Next
            </button>
          </div>
          <div class="d-flex align-items-center">
            <label for="pageSizeSelect" class="me-2">Records per page:</label>
            <select
              id="pageSizeSelect"
              class="form-select form-select-sm"
              aria-label="Select Page Size"
            >
              <option value="10" selected>10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
          </div>
          <span id="pageInfo" class="ms-2" aria-live="polite"></span>
        </div>
      </div>
    </section>    

    <!-- Visualization Section -->
    <section class="row g-3 form-section" id="visualizationSection">
      <h3>Data Visualizations</h3>
      <div class="col-md-12">
        <button
          class="btn btn-success"
          id="openVisualizationModalBtn"
          aria-label="Open Visualization Modal"
        >
          Open Visualization Modal
        </button>
      </div>
    </section>

    <!-- Onboarding / Tutorials (optional triggers) -->
    <section class="row g-3 form-section d-none" id="onboardingSection">
      <h3>Onboarding & Tutorials</h3>
      <button
        class="btn btn-primary"
        id="startOnboardingBtn"
        aria-label="Start Onboarding Tutorial"
      >
        Start Tutorial
      </button>
    </section>

  </div>

  <!-- ===== Notification Area ===== -->
  <div id="notification" aria-live="polite" aria-atomic="true"></div>

  <!-- ===== Column Selection & Reorder Modal ===== -->
  <div
    class="modal fade"
    id="columnModal"
    tabindex="-1"
    aria-labelledby="columnModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="columnModalLabel">Select and Reorder Columns</h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body row">
          <div class="col-md-5">
            <h6>Available Fields</h6>
            <ul id="availableFields" class="column-list" aria-label="Available Fields List"></ul>
          </div>
          <div class="col-md-2 d-flex flex-column justify-content-center align-items-center move-buttons">
            <button class="btn btn-success mb-3" id="moveToSelected" aria-label="Add Selected Fields">
              Add &raquo;
            </button>
            <button class="btn btn-danger" id="moveToAvailable" aria-label="Remove Selected Fields">
              &laquo; Remove
            </button>
          </div>
          <div class="col-md-5">
            <h6>Selected Fields (Drag to Reorder)</h6>
            <ul id="selectedFields" class="column-list" aria-label="Selected Fields List"></ul>
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
            aria-label="Cancel Column Selection"
          >
            Cancel
          </button>
          <button
            type="button"
            class="btn btn-primary"
            id="saveColumnsBtn"
            aria-label="Save Selected Columns"
          >
            Save Changes
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Visualization Modal ===== -->
  <div
    class="modal fade"
    id="visualizationModal"
    tabindex="-1"
    aria-labelledby="visualizationModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="visualizationModalLabel">Data Visualization</h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body">
          <!-- Visualization Container -->
          <div id="chartContainer" class="chart-container">
            <!-- Charts (Bar, Pie, Line, etc.) will be appended dynamically here -->
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
            aria-label="Close Modal"
          >
            Close
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Bootstrap & Dependencies ===== -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script
    src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"
    integrity="sha256-lSjKY0/srUM9BE3dPm+c4fBo1dky2v27Gdjm2uoZaL0="
    crossorigin="anonymous"
  ></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ===== External Libraries for Export & Visualization ===== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- ===== Our Modular JS Files ===== -->
  <script src="js/utils/errorHandling.js"></script>
  <script src="js/utils/helpers.js"></script>

  <script src="js/app.js"></script>
  <script src="js/connection.js"></script>
  <script src="js/dataGrid.js"></script>
  <script src="js/filters.js"></script>
  <script src="js/export.js"></script>
  <script src="js/visualization.js"></script>
  <script src="js/management.js"></script>
  <script src="js/localization.js"></script>
  <script src="js/onboarding.js"></script>
  <script src="js/preferences.js"></script>

</body>
</html>